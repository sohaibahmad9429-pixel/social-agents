# =============================================================================
# Render Blueprint Configuration
# Deploy Content Creator with Docker Compose
# =============================================================================
# 
# To deploy:
# 1. Push this file to your repository
# 2. Connect your repository to Render
# 3. Render will detect this file and create a Blueprint
# 4. Configure environment variables in the Render dashboard
#
# Documentation: https://render.com/docs/infrastructure-as-code
# =============================================================================

services:
  # ==========================================================================
  # Python FastAPI Backend
  # ==========================================================================
  - type: web
    name: content-creator-backend
    runtime: docker
    dockerfilePath: ./Dockerfile.backend
    dockerContext: .
    region: oregon
    plan: starter
    envVars:
      # ==========================================================================
      # Server Configuration
      # ==========================================================================
      - key: HOST
        value: 0.0.0.0
      - key: PORT
        value: 10000
      - key: DEBUG
        value: false
      - key: ENVIRONMENT
        value: production
      
      # Frontend URL for CORS (auto-linked, backend transforms to full HTTPS URL)
      - key: APP_URL
        fromService:
          type: web
          name: content-creator-frontend
          property: host
      
      # CORS Origins (comma-separated, auto-linked frontend URL)
      - key: CORS_ORIGINS
        fromService:
          type: web
          name: content-creator-frontend
          property: host
      
      # Backend URL for OAuth callbacks (must be the public backend URL)
      - key: BACKEND_URL
        fromService:
          type: web
          name: content-creator-backend
          property: host
      
      # ==========================================================================
      # Supabase Configuration (set in Render Dashboard)
      # ==========================================================================
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_KEY
        sync: false
      - key: SUPABASE_SERVICE_KEY
        sync: false
      - key: DATABASE_URL
        sync: false
      
      # ==========================================================================
      # AI Provider API Keys (set in Render Dashboard)
      # ==========================================================================
      - key: GOOGLE_API_KEY
        sync: false
      - key: OPENAI_API_KEY
        sync: false
      - key: ANTHROPIC_API_KEY
        sync: false
      - key: GROQ_API_KEY
        sync: false
      - key: DEEPSEEK_API_KEY
        sync: false
      - key: ELEVENLABS_API_KEY
        sync: false
      
      # ==========================================================================
      # Rate Limiting
      # ==========================================================================
      - key: RATE_LIMIT_REQUESTS
        value: 1000
      - key: RATE_LIMIT_AUTH_ATTEMPTS
        value: 5
      
      # ==========================================================================
      # Social Platform OAuth (set in Render Dashboard)
      # ==========================================================================
      # Facebook / Meta
      - key: FACEBOOK_CLIENT_ID
        sync: false
      - key: FACEBOOK_CLIENT_SECRET
        sync: false
      
      # Instagram (uses Facebook App)
      - key: INSTAGRAM_CLIENT_ID
        sync: false
      - key: INSTAGRAM_CLIENT_SECRET
        sync: false
      
      # Twitter/X (OAuth 2.0)
      - key: TWITTER_CLIENT_ID
        sync: false
      - key: TWITTER_CLIENT_SECRET
        sync: false
      # Twitter/X (OAuth 1.0a)
      - key: TWITTER_API_KEY
        sync: false
      - key: TWITTER_API_SECRET
        sync: false
      
      # LinkedIn
      - key: LINKEDIN_CLIENT_ID
        sync: false
      - key: LINKEDIN_CLIENT_SECRET
        sync: false
      
      # TikTok
      - key: TIKTOK_CLIENT_ID
        sync: false
      - key: TIKTOK_CLIENT_SECRET
        sync: false
      - key: TIKTOK_CLIENT_KEY
        sync: false
      
      # YouTube/Google
      - key: YOUTUBE_CLIENT_ID
        sync: false
      - key: YOUTUBE_CLIENT_SECRET
        sync: false
      
      # Canva
      - key: CANVA_CLIENT_ID
        sync: false
      - key: CANVA_CLIENT_SECRET
        sync: false
      
      # ==========================================================================
      # Media Storage - Cloudinary (set in Render Dashboard)
      # ==========================================================================
      - key: CLOUDINARY_CLOUD_NAME
        sync: false
      - key: CLOUDINARY_API_KEY
        sync: false
      - key: CLOUDINARY_API_SECRET
        sync: false
      
      # ==========================================================================
      # LangSmith Tracing (set in Render Dashboard)
      # ==========================================================================
      - key: LANGSMITH_TRACING
        value: true
      - key: LANGSMITH_ENDPOINT
        value: https://api.smith.langchain.com
      - key: LANGSMITH_API_KEY
        sync: false
      - key: LANGSMITH_PROJECT
        sync: false
      
      # ==========================================================================
      # Email Service - Resend (set in Render Dashboard)
      # ==========================================================================
      - key: RESEND_API_KEY
        sync: false
      - key: SMTP_FROM_EMAIL
        sync: false
      - key: SMTP_FROM_NAME
        value: Content OS
      
      # ==========================================================================
      # Cron/Scheduled Jobs Authentication
      # ==========================================================================
      - key: CRON_SECRET
        sync: false

  # ==========================================================================
  # Next.js Frontend
  # ==========================================================================
  - type: web
    name: content-creator-frontend
    runtime: docker
    dockerfilePath: ./Dockerfile.frontend
    dockerContext: .
    region: oregon
    plan: starter
    envVars:
      - key: NODE_ENV
        value: production
      
      # Python Backend URL (auto-linked to backend service)
      # Uses 'host' property which returns just hostname, frontend config adds https://
      - key: NEXT_PUBLIC_PYTHON_BACKEND_URL
        fromService:
          type: web
          name: content-creator-backend
          property: host
      
      # Server-side Python Backend URL (for API routes running on the server)
      - key: PYTHON_BACKEND_URL
        fromService:
          type: web
          name: content-creator-backend
          property: host
      
      # Supabase Client (set in Render Dashboard)
      - key: NEXT_PUBLIC_SUPABASE_URL
        sync: false
      - key: NEXT_PUBLIC_SUPABASE_ANON_KEY
        sync: false
      
      # App URL for OAuth redirects (auto-linked)
      - key: NEXT_PUBLIC_APP_URL
        fromService:
          type: web
          name: content-creator-frontend
          property: host
      
      # Feature Flags
      - key: NEXT_PUBLIC_USE_PYTHON_BACKEND_ALL
        value: true
